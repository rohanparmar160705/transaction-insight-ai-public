./all_files_compact.txt
===== FILE: ./all_files_compact.txt =====
./all_files_compact.txt=====FILE:./all_files_compact.txt=====./Dockerfile
===== FILE: ./Dockerfile =====
#Multi-stagebuildforproduction-readyNode.jsbackend#Stage1:BuildFROMnode:18-alpineASbuilderWORKDIR/app#CopypackagefilesCOPYpackage*.json./COPYprisma./prisma/#InstalldependenciesRUNnpmci#CopysourcecodeCOPY..#GeneratePrismaclientRUNnpxprismagenerate#BuildTypeScriptRUNnpmrunbuild#Stage2:ProductionFROMnode:18-alpineWORKDIR/app#Installdumb-initforpropersignalhandlingRUNapkadd--no-cachedumb-init#Createnon-rootuserRUNaddgroup-g1001-Snodejs&&\adduser-Snodejs-u1001#CopypackagefilesCOPYpackage*.json./#InstallproductiondependenciesonlyRUNnpmci--only=production&&npmcacheclean--force#CopyPrismaschemaandgeneratedclientCOPY--from=builder/app/prisma./prismaCOPY--from=builder/app/node_modules/.prisma./node_modules/.prisma#CopybuiltapplicationCOPY--from=builder/app/dist./dist#CreateuploadsdirectoryRUNmkdir-p/app/uploads&&chownnodejs:nodejs/app/uploads#Switchtonon-rootuserUSERnodejs#ExposeportEXPOSE5000#HealthcheckHEALTHCHECK--interval=30s--timeout=3s--start-period=40s\CMDnode-e"require('http').get('http://localhost:5000/health',(r)=>{process.exit(r.statusCode===200?0:1)})"#Startapplicationwithdumb-initENTRYPOINT["dumb-init","--"]CMD["node","dist/index.js"]./package.json
===== FILE: ./package.json =====
{"name":"transaction-insight-backend","version":"1.0.0","description":"BackendAPIforTransactionInsightAI","main":"dist/index.js","scripts":{"dev":"nodemon--exects-nodesrc/index.ts","build":"tsc","start":"nodedist/index.js","prisma:generate":"prismagenerate","prisma:migrate":"prismamigratedev","prisma:studio":"prismastudio","prisma:seed":"ts-nodeprisma/seed.ts","test":"jest--detectOpenHandles","lint":"eslintsrc--ext.ts"},"keywords":["transaction","ai","banking","ml"],"author":"YourName","license":"MIT","dependencies":{"@prisma/client":"^6.19.0","axios":"^1.13.2","bcrypt":"^6.0.0","cors":"^2.8.5","csv-parser":"^3.2.0","dotenv":"^17.2.3","express":"^5.1.0","express-validator":"^7.3.0","helmet":"^8.1.0","jsonwebtoken":"^9.0.2","multer":"^2.0.2","pdf-parse":"^2.4.5","uuid":"^13.0.0","winston":"^3.18.3","zod":"^4.1.12"},"devDependencies":{"@types/bcrypt":"^6.0.0","@types/cors":"^2.8.19","@types/express":"^5.0.5","@types/jest":"^30.0.0","@types/jsonwebtoken":"^9.0.10","@types/multer":"^2.0.0","@types/node":"^24.10.1","@types/pdf-parse":"^1.1.5","@typescript-eslint/eslint-plugin":"^8.46.4","@typescript-eslint/parser":"^8.46.4","eslint":"^9.39.1","jest":"^30.2.0","nodemon":"^3.1.11","prisma":"^6.19.0","ts-node":"^10.9.2","typescript":"^5.9.3"},"type":"commonjs"}./prisma/schema.prisma
===== FILE: ./prisma/schema.prisma =====
//PrismaSchemaforTransactionInsightAI//Thisdefinesourdatabasemodelsandrelationshipsgeneratorclient{provider="prisma-client-js"}datasourcedb{provider="postgresql"url=env("DATABASE_URL")shadowDatabaseUrl=env("DATABASE_SHADOW_URL")}//Usermodel-storesuserauthenticationandprofileinformationmodelUser{idString@id@default(uuid())emailString@uniquepasswordString//HashedwithbcryptnameStringcreatedAtDateTime@default(now())updatedAtDateTime@updatedAt//RelationshipstransactionsTransaction[]uploadsUpload[]@@map("users")}//Transactionmodel-storesindividualbanktransactionsmodelTransaction{idString@id@default(uuid())userIdStringuploadIdString?//Optional:linktotheuploadbatch//TransactiondetailsdateDateTimedescriptionStringamountFloattypeTransactionType//DEBITorCREDIT//MLpredictionscategoryString//Predictedcategory(e.g.,"Food","Transport")predictionConfidenceFloat//ConfidencescorefromMLmodel(0-1)//MetadatacreatedAtDateTime@default(now())updatedAtDateTime@updatedAt//RelationshipsuserUser@relation(fields:[userId],references:[id],onDelete:Cascade)uploadUpload?@relation(fields:[uploadId],references:[externalId],onDelete:SetNull)@@index([userId])@@index([date])@@index([category])@@map("transactions")}//Uploadmodel-tracksfileuploadsforauditingmodelUpload{idString@id@default(uuid())externalIdString@uniqueuserIdStringfileNameStringfileTypeString//CSVorPDFfileSizeIntstatusUploadStatus@default(PROCESSING)errorMessageString?transactionCountInt?//NumberoftransactionsextractedcreatedAtDateTime@default(now())updatedAtDateTime@updatedAt//RelationshipsuserUser@relation(fields:[userId],references:[id],onDelete:Cascade)transactionsTransaction[]@@index([userId])@@map("uploads")}//EnumsenumTransactionType{DEBITCREDIT}enumUploadStatus{PROCESSINGCOMPLETEDFAILED}./prisma/seed.ts
===== FILE: ./prisma/seed.ts =====
/***PrismaSeedScript*Thisscriptpopulatesthedatabasewithinitialtestdata*Runwith:npmrunprisma:seed*/import{PrismaClient}from'@prisma/client';importbcryptfrom'bcrypt';constprisma=newPrismaClient();asyncfunctionmain(){console.log('ðŸŒ±Startingdatabaseseed...');//CreateatestuserconsthashedPassword=awaitbcrypt.hash('rohan123',10);constuser=awaitprisma.user.upsert({where:{email:'test@example.com'},update:{},create:{email:'test@example.com',password:hashedPassword,name:'TestUser',},});console.log('âœ…Createdtestuser:',user.email);//CreatesampletransactionsconstsampleTransactions=[{date:newDate('2024-01-15'),description:'WalmartGroceryStore',amount:-85.50,type:'DEBIT'asconst,category:'Groceries',predictionConfidence:0.95,},{date:newDate('2024-01-16'),description:'ShellGasStation',amount:-45.20,type:'DEBIT'asconst,category:'Transportation',predictionConfidence:0.92,},{date:newDate('2024-01-17'),description:'NetflixSubscription',amount:-15.99,type:'DEBIT'asconst,category:'Entertainment',predictionConfidence:0.98,},{date:newDate('2024-01-18'),description:'SalaryDeposit',amount:3500.00,type:'CREDIT'asconst,category:'Income',predictionConfidence:0.99,},{date:newDate('2024-01-19'),description:'AmazonPurchase',amount:-129.99,type:'DEBIT'asconst,category:'Shopping',predictionConfidence:0.88,},];for(consttxnofsampleTransactions){awaitprisma.transaction.create({data:{...txn,userId:user.id,},});}console.log(`âœ…Created${sampleTransactions.length}sampletransactions`);console.log('ðŸŽ‰Seedcompletedsuccessfully!');}main().catch((e)=>{console.error('âŒSeedfailed:',e);process.exit(1);}).finally(async()=>{awaitprisma.$disconnect();});./README.md
===== FILE: ./README.md =====
#TransactionInsightAI-BackendNode.js+TypeScript+Express+PrismabackendforTransactionInsightAI.##ðŸš€Features-**Authentication**:JWT-baseduserregistrationandlogin-**FileUpload**:SupportforCSVandPDFbankstatements-**MLIntegration**:AutomatictransactioncategorizationviaFastAPIMLservice-**RESTAPI**:CompleteCRUDoperationsfortransactions-**Analytics**:Financialinsightsandspendingpatterns-**Database**:PostgreSQLwithPrismaORM-**Security**:Helmet,CORS,bcryptpasswordhashing-**Logging**:Winston-basedstructuredlogging##ðŸ“‹Prerequisites-Node.js18+-PostgreSQL14+-MLServicerunningonport8000##ðŸ› ï¸Setup###1.InstallDependencies```bashnpminstall```###2.ConfigureEnvironmentCopy`.env.example`to`.env`andconfigure:```bashcp.env.example.env```Edit`.env`:```envDATABASE_URL="postgresql://postgres:postgres@localhost:5432/transaction_insight"JWT_SECRET="your-super-secret-jwt-key-change-this"ML_SERVICE_URL="http://localhost:8000"PORT=5000```###3.InitializeDatabase```bash#GeneratePrismaclientnpmrunprisma:generate#Runmigrationsnpmrunprisma:migrate#Seedwithtestdata(optional)npmrunprisma:seed```###4.StartDevelopmentServer```bashnpmrundev```Serverrunson`http://localhost:5000`##ðŸ“¡APIEndpoints###Authentication-`POST/api/auth/signup`-Registernewuser-`POST/api/auth/login`-Loginuser###FileUpload-`POST/api/upload`-UploadCSV/PDF(requiresauth)###Transactions-`GET/api/transactions`-Listtransactions(requiresauth)-Queryparams:`page`,`limit`,`category`,`startDate`,`endDate`-`GET/api/insights`-Getanalytics(requiresauth)-Queryparams:`startDate`,`endDate`###HealthCheck-`GET/health`-Servicehealthstatus##ðŸ§ªTestingTesttheAPIwithsampledata:```bash#Registerausercurl-XPOSThttp://localhost:5000/api/auth/signup\-H"Content-Type:application/json"\-d'{"email":"test@example.com","password":"password123","name":"TestUser"}'#Logincurl-XPOSThttp://localhost:5000/api/auth/login\-H"Content-Type:application/json"\-d'{"email":"test@example.com","password":"password123"}'#Uploadfile(replaceTOKENwithJWTfromlogin)curl-XPOSThttp://localhost:5000/api/upload\-H"Authorization:BearerTOKEN"\-F"file=@/path/to/statement.csv"```##ðŸ³DockerBuildandrunwithDocker:```bash#Buildimagedockerbuild-ttransaction-insight-backend.#Runcontainerdockerrun-p5000:5000\-eDATABASE_URL="postgresql://postgres:postgres@host.docker.internal:5432/transaction_insight"\-eJWT_SECRET="your-secret"\-eML_SERVICE_URL="http://host.docker.internal:8000"\transaction-insight-backend```##ðŸ“ProjectStructure```backend/â”œâ”€â”€src/â”‚â”œâ”€â”€index.ts#Serverentrypointâ”‚â”œâ”€â”€app.ts#Expressappconfigurationâ”‚â”œâ”€â”€prismaClient.ts#Prismasingletonâ”‚â”œâ”€â”€routes/#APIroutedefinitionsâ”‚â”œâ”€â”€controllers/#Requesthandlersâ”‚â”œâ”€â”€middleware/#Authmiddlewareâ”‚â”œâ”€â”€services/#Externalserviceclients(ML)â”‚â”œâ”€â”€utils/#Utilities(parsers,logger)â”‚â””â”€â”€types/#TypeScripttypesâ”œâ”€â”€prisma/â”‚â”œâ”€â”€schema.prisma#Databaseschemaâ”‚â””â”€â”€seed.ts#Testdataseederâ”œâ”€â”€Dockerfileâ”œâ”€â”€package.jsonâ””â”€â”€tsconfig.json```##ðŸ”§DevelopmentCommands```bashnpmrundev#Startdevserverwithhotreloadnpmrunbuild#Buildforproductionnpmrunstart#Startproductionservernpmrunlint#Lintcodenpmrunprisma:studio#OpenPrismaStudio(DBGUI)```##ðŸ”SecurityNotes-Nevercommit`.env`file-Change`JWT_SECRET`inproduction-Usestrongpasswords-EnableHTTPSinproduction-SetproperCORSorigins##ðŸ“DatabaseSchema###User-id,email,password(hashed),name,timestamps###Transaction-id,userId,date,description,amount,type(DEBIT/CREDIT)-category,predictionConfidence-uploadId(optional)###Upload-id,userId,fileName,fileType,fileSize-status,errorMessage,transactionCount##ðŸ¤Contributing1.FollowTypeScriptbestpractices2.Addpropererrorhandling3.Writedescriptivecomments4.Testallendpointsbeforecommitting./src/app.ts
===== FILE: ./src/app.ts =====
/***ExpressAppConfiguration*Setsupmiddleware,routes,anderrorhandling*/importexpress,{Application,Request,Response,NextFunction}from'express';importcorsfrom'cors';importhelmetfrom'helmet';importauthRoutesfrom'./routes/authRoutes';importuploadRoutesfrom'./routes/uploadRoutes';importtransactionRoutesfrom'./routes/transactionRoutes';importloggerfrom'./utils/logger';constapp:Application=express();//Securitymiddlewareapp.use(helmet());//Addssecurityheaders//CORSconfigurationconstcorsOptions={origin:process.env.CORS_ORIGIN||'http://localhost:5173',credentials:true,optionsSuccessStatus:200,};app.use(cors(corsOptions));//Bodyparsingmiddlewareapp.use(express.json({limit:'10mb'}));app.use(express.urlencoded({extended:true,limit:'10mb'}));//Requestloggingmiddlewareapp.use((_req:Request,_res:Response,next:NextFunction)=>{logger.http(`${_req.method}${_req.path}`);next();});//Healthcheckendpointapp.get('/health',(_req:Request,res:Response)=>{res.status(200).json({success:true,message:'Backendserviceishealthy',timestamp:newDate().toISOString(),});});//APIRoutesapp.use('/api/auth',authRoutes);app.use('/api/upload',uploadRoutes);app.use('/api/transactions',transactionRoutes);app.use('/api/insights',transactionRoutes);//insightsrouteispartoftransactionroutes//404handlerapp.use((_req:Request,res:Response)=>{res.status(404).json({success:false,error:'Routenotfound',});});//Globalerrorhandlerapp.use((err:Error,_req:Request,res:Response,_next:NextFunction)=>{logger.error(`Error:${err.message}`,{stack:err.stack});//Multerfileuploaderrorsif(err.message.includes('Filetoolarge')){res.status(413).json({success:false,error:'Filetoolarge.Maximumfilesizeis10MB.',});return;}if(err.message.includes('Invalidfiletype')){res.status(400).json({success:false,error:err.message,});return;}//Genericerrorresponseres.status(500).json({success:false,error:'Internalservererror',...(process.env.NODE_ENV==='development'&&{details:err.message}),});});exportdefaultapp;./src/controllers/authControllers.ts
===== FILE: ./src/controllers/authControllers.ts =====
/***AuthenticationController*Handlesuserregistration,login,andtokengeneration*/import{Request,Response}from'express';importbcryptfrom'bcrypt';//importjwtfrom'jsonwebtoken';importjwt,{SignOptions,Secret}from'jsonwebtoken';import{z}from'zod';importprismafrom'../prismaClient';import{RegisterDTO,LoginDTO,ApiResponse}from'../types';importloggerfrom'../utils/logger';//ValidationschemasusingZodconstregisterSchema=z.object({email:z.string().email('Invalidemailformat'),password:z.string().min(6,'Passwordmustbeatleast6characters'),name:z.string().min(2,'Namemustbeatleast2characters'),});constloginSchema=z.object({email:z.string().email('Invalidemailformat'),password:z.string().min(1,'Passwordisrequired'),});/***Registeranewuser*POST/api/auth/signup*/exportasyncfunctionsignup(req:Request,res:Response):Promise<void>{try{//ValidaterequestbodyconstvalidatedData=registerSchema.parse(req.body)asRegisterDTO;//CheckifuseralreadyexistsconstexistingUser=awaitprisma.user.findUnique({where:{email:validatedData.email},});if(existingUser){res.status(409).json({success:false,error:'Userwiththisemailalreadyexists',}asApiResponse);return;}//HashpasswordconstsaltRounds=10;consthashedPassword=awaitbcrypt.hash(validatedData.password,saltRounds);//Createuserconstuser=awaitprisma.user.create({data:{email:validatedData.email,password:hashedPassword,name:validatedData.name,},select:{id:true,email:true,name:true,createdAt:true,},});//GenerateJWTtokenconsttoken=generateToken(String(user.id),user.email);logger.info(`Newuserregistered:${user.email}`);res.status(201).json({success:true,data:{user,token,},message:'Userregisteredsuccessfully',}asApiResponse);}catch(error){if(errorinstanceofz.ZodError){res.status(400).json({success:false,error:'Validationfailed',data:error.issues,}asApiResponse);return;}logger.error(`Signuperror:${error}`);res.status(500).json({success:false,error:'Failedtoregisteruser',}asApiResponse);}}/***Loginexistinguser*POST/api/auth/login*/exportasyncfunctionlogin(req:Request,res:Response):Promise<void>{try{//ValidaterequestbodyconstvalidatedData=loginSchema.parse(req.body)asLoginDTO;//Finduserbyemailconstuser=awaitprisma.user.findUnique({where:{email:validatedData.email},});if(!user){res.status(401).json({success:false,error:'Invalidemailorpassword',}asApiResponse);return;}//VerifypasswordconstisPasswordValid=awaitbcrypt.compare(validatedData.password,user.password);if(!isPasswordValid){res.status(401).json({success:false,error:'Invalidemailorpassword',}asApiResponse);return;}//GenerateJWTtokenconsttoken=generateToken(user.id,user.email);logger.info(`Userloggedin:${user.email}`);res.status(200).json({success:true,data:{user:{id:user.id,email:user.email,name:user.name,createdAt:user.createdAt,},token,},message:'Loginsuccessful',}asApiResponse);}catch(error){if(errorinstanceofz.ZodError){res.status(400).json({success:false,error:'Validationfailed',data:error.issues,}asApiResponse);return;}logger.error(`Loginerror:${error}`);res.status(500).json({success:false,error:'Loginfailed',}asApiResponse);}}/***GenerateJWTtokenforauthenticateduser*/functiongenerateToken(userId:string,email:string):string{constjwtSecret=process.env.JWT_SECRETasstring;constjwtExpiry=parseInt(process.env.JWT_EXPIRY||'7',10)*24*60*60;if(!jwtSecret){thrownewError('JWT_SECRETnotconfigured');}//Ensuretypesmatchjsonwebtoken'sexpectedtypesconstsecret:Secret=jwtSecret;constsignOptions:SignOptions={expiresIn:jwtExpiry};returnjwt.sign({userId,email},secret,signOptions);}./src/controllers/transactionControllers.ts
===== FILE: ./src/controllers/transactionControllers.ts =====
/***TransactionController*Handlestransactionlistingandinsights/analytics*/import{Response}from'express';import{AuthRequest,ApiResponse,InsightsData}from'../types';importprismafrom'../prismaClient';importloggerfrom'../utils/logger';/***Getalltransactionsforauthenticateduser*GET/api/transactions*Queryparams:page,limit,category,startDate,endDate*/exportasyncfunctiongetTransactions(req:AuthRequest,res:Response):Promise<void>{try{if(!req.user){res.status(401).json({success:false,error:'Authenticationrequired',}asApiResponse);return;}constuserId=req.user.userId;//Parsequeryparametersconstpage=parseInt(req.query.pageasstring)||1;constlimit=parseInt(req.query.limitasstring)||50;constcategory=req.query.categoryasstring;conststartDate=req.query.startDateasstring;constendDate=req.query.endDateasstring;//Buildfilterconstwhere:any={userId};if(category){where.category=category;}if(startDate||endDate){where.date={};if(startDate){where.date.gte=newDate(startDate);}if(endDate){where.date.lte=newDate(endDate);}}//Fetchtransactionswithpaginationconst[transactions,totalCount]=awaitPromise.all([prisma.transaction.findMany({where,orderBy:{date:'desc'},skip:(page-1)*limit,take:limit,select:{id:true,date:true,description:true,amount:true,type:true,category:true,predictionConfidence:true,createdAt:true,},}),prisma.transaction.count({where}),]);logger.info(`Retrieved${transactions.length}transactionsforuser${userId}`);res.status(200).json({success:true,data:{transactions,pagination:{page,limit,totalCount,totalPages:Math.ceil(totalCount/limit),},},}asApiResponse);}catch(error){logger.error(`Gettransactionserror:${error}`);res.status(500).json({success:false,error:'Failedtofetchtransactions',}asApiResponse);}}/***Getfinancialinsightsandanalytics*GET/api/insights*Queryparams:startDate,endDate*/exportasyncfunctiongetInsights(req:AuthRequest,res:Response):Promise<void>{try{if(!req.user){res.status(401).json({success:false,error:'Authenticationrequired',}asApiResponse);return;}constuserId=req.user.userId;conststartDate=req.query.startDate?newDate(req.query.startDateasstring):newDate(newDate().setMonth(newDate().getMonth()-6));//Default:last6monthsconstendDate=req.query.endDate?newDate(req.query.endDateasstring):newDate();//Fetchalltransactionsindaterangeconsttransactions=awaitprisma.transaction.findMany({where:{userId,date:{gte:startDate,lte:endDate,},},orderBy:{date:'asc'},});//Calculateinsightsconstinsights=calculateInsights(transactions);logger.info(`Generatedinsightsforuser${userId}`);res.status(200).json({success:true,data:insights,}asApiResponse);}catch(error){logger.error(`Getinsightserror:${error}`);res.status(500).json({success:false,error:'Failedtogenerateinsights',}asApiResponse);}}/***Calculatefinancialinsightsfromtransactions*/functioncalculateInsights(transactions:any[]):InsightsData{//CalculatetotalincomeandexpenseslettotalIncome=0;lettotalExpenses=0;transactions.forEach(txn=>{if(txn.type==='CREDIT'){totalIncome+=txn.amount;}else{totalExpenses+=txn.amount;}});constnetSavings=totalIncome-totalExpenses;//CategorybreakdownconstcategoryMap=newMap<string,{total:number;count:number}>();transactions.forEach(txn=>{if(txn.type==='DEBIT'){//Onlyexpensesconstexisting=categoryMap.get(txn.category)||{total:0,count:0};categoryMap.set(txn.category,{total:existing.total+txn.amount,count:existing.count+1,});}});constcategoryBreakdown=Array.from(categoryMap.entries()).map(([category,data])=>({category,total:data.total,count:data.count,percentage:(data.total/totalExpenses)*100,})).sort((a,b)=>b.total-a.total);//MonthlytrendconstmonthlyMap=newMap<string,{income:number;expenses:number}>();transactions.forEach(txn=>{constmonthKey=txn.date.toISOString().substring(0,7);//YYYY-MMconstexisting=monthlyMap.get(monthKey)||{income:0,expenses:0};if(txn.type==='CREDIT'){existing.income+=txn.amount;}else{existing.expenses+=txn.amount;}monthlyMap.set(monthKey,existing);});constmonthlyTrend=Array.from(monthlyMap.entries()).map(([month,data])=>({month,income:data.income,expenses:data.expenses,})).sort((a,b)=>a.month.localeCompare(b.month));//TopexpensesconsttopExpenses=transactions.filter(txn=>txn.type==='DEBIT').sort((a,b)=>b.amount-a.amount).slice(0,10).map(txn=>({description:txn.description,amount:txn.amount,date:txn.date,category:txn.category,}));return{totalIncome,totalExpenses,netSavings,categoryBreakdown,monthlyTrend,topExpenses,};}./src/controllers/uploadControllers.ts
===== FILE: ./src/controllers/uploadControllers.ts =====
/***UploadController*HandlesCSV/PDFfileuploads,parsing,MLpredictions,andstorage*/import{Response}from'express';importfsfrom'fs/promises';import{v4asuuidv4}from'uuid';import{AuthRequest,ApiResponse,ParsedTransaction}from'../types';import{parseCSV}from'../utils/parseCSV';import{parsePDF}from'../utils/parsePDF';importmlClientfrom'../services/mlClient';importprismafrom'../prismaClient';importloggerfrom'../utils/logger';/***Uploadandprocessbankstatementfile(CSVorPDF)*POST/api/upload*/exportasyncfunctionuploadFile(req:AuthRequest,res:Response):Promise<void>{constuploadId=uuidv4();//UseuuidforamorerobustuniqueIDtry{//Checkifuserisauthenticatedif(!req.user){res.status(401).json({success:false,error:'Authenticationrequired',}asApiResponse);return;}//Checkiffilewasuploadedif(!req.file){res.status(400).json({success:false,error:'Nofileuploaded.PleaseuploadaCSVorPDFfile.',}asApiResponse);return;}constfile=req.file;constuserId=req.user.userId;logger.info(`Processingupload${uploadId}foruser${userId}:${file.originalname}`);//CreateuploadrecordwiththeexternalIdconstupload=awaitprisma.upload.create({data:{externalId:uploadId,userId,fileName:file.originalname,fileType:file.mimetype,fileSize:file.size,status:'PROCESSING',},});try{//Step1:Parsefilebasedontypelettransactions:ParsedTransaction[];if(file.mimetype==='text/csv'||file.originalname.endsWith('.csv')){transactions=awaitparseCSV(file.path);}elseif(file.mimetype==='application/pdf'||file.originalname.endsWith('.pdf')){transactions=awaitparsePDF(file.path);}else{thrownewError('Unsupportedfiletype.PleaseuploadCSVorPDF.');}if(transactions.length===0){thrownewError('Notransactionsfoundinfile');}logger.info(`Parsed${transactions.length}transactionsfromfileforupload${uploadId}`);//Step2:GetMLpredictionsforcategoriesconstpredictions=awaitmlClient.predictCategories(transactions);if(predictions.predictions.length!==transactions.length){thrownewError('MLpredictioncountmismatch');}//Step3:Storetransactionsindatabase,linkingthemwiththegenerateduploadIdconsttransactionRecords=awaitprisma.transaction.createMany({data:transactions.map((txn,index)=>({userId,uploadId:upload.externalId,//UsetheexternalIddate:txn.date,description:txn.description,amount:txn.amount,type:txn.type,category:predictions.predictions[index].category,predictionConfidence:predictions.predictions[index].confidence,})),});//Step4:Updateuploadstatusawaitprisma.upload.update({where:{id:upload.id},data:{status:'COMPLETED',transactionCount:transactionRecords.count,},});//Step5:Cleanupuploadedfileawaitfs.unlink(file.path).catch(err=>logger.warn(`Failedtodeleteuploadedfile:${err}`));logger.info(`Successfullyprocessed${transactionRecords.count}transactionsforupload${uploadId}`);//ReturnsuccessresponsewiththegenerateduploadIdres.status(200).json({success:true,data:{uploadId:upload.externalId,fileName:file.originalname,transactionCount:transactionRecords.count,},message:`Successfullyprocessed${transactionRecords.count}transactions`,}asApiResponse);}catch(processingError){//Updateuploadstatustofailedawaitprisma.upload.update({where:{id:upload.id},data:{status:'FAILED',errorMessage:processingErrorinstanceofError?processingError.message:'Processingfailed',},});//Cleanupuploadedfileawaitfs.unlink(file.path).catch(()=>{});throwprocessingError;}}catch(error){consterrorMessage=errorinstanceofError?error.message:'Uploadprocessingfailed';logger.error(`Uploadprocessingerrorforupload${uploadId}:${errorMessage}`);res.status(500).json({success:false,error:errorMessage,uploadId:uploadId,//IncludeuploadIdinerrorresponsefortracking}asApiResponse);}}./src/index.ts
===== FILE: ./src/index.ts =====
/***ServerEntryPoint*InitializestheExpressserverandconnectstothedatabase*/importdotenvfrom'dotenv';importfsfrom'fs';//importpathfrom'path';importappfrom'./app';importprismafrom'./prismaClient';importloggerfrom'./utils/logger';//Loadenvironmentvariablesdotenv.config();//ConfigurationconstPORT=process.env.PORT||5000;constUPLOAD_DIR=process.env.UPLOAD_DIR||'./uploads';/***Ensureuploaddirectoryexists*/functionensureUploadDir(){if(!fs.existsSync(UPLOAD_DIR)){fs.mkdirSync(UPLOAD_DIR,{recursive:true});logger.info(`Createduploaddirectory:${UPLOAD_DIR}`);}}/***Testdatabaseconnection*/asyncfunctiontestDatabaseConnection(){try{awaitprisma.$connect();logger.info('âœ…Databaseconnectedsuccessfully');}catch(error){logger.error('âŒDatabaseconnectionfailed:',error);throwerror;}}/***Gracefulshutdownhandler*/asyncfunctiongracefulShutdown(signal:string){logger.info(`${signal}received.Startinggracefulshutdown...`);try{awaitprisma.$disconnect();logger.info('Databaseconnectionclosed');process.exit(0);}catch(error){logger.error('Errorduringshutdown:',error);process.exit(1);}}/***Starttheserver*/asyncfunctionstartServer(){try{//EnsureuploaddirectoryexistsensureUploadDir();//TestdatabaseconnectionawaittestDatabaseConnection();//Startlisteningapp.listen(PORT,()=>{logger.info(`ðŸš€Serverrunningonport${PORT}`);logger.info(`ðŸ“ŠEnvironment:${process.env.NODE_ENV||'development'}`);logger.info(`ðŸ”—Healthcheck:http://localhost:${PORT}/health`);});//Handleshutdownsignalsprocess.on('SIGTERM',()=>gracefulShutdown('SIGTERM'));process.on('SIGINT',()=>gracefulShutdown('SIGINT'));}catch(error){logger.error('Failedtostartserver:',error);process.exit(1);}}//StarttheserverstartServer();./src/middleware/auth.ts
===== FILE: ./src/middleware/auth.ts =====
/***AuthenticationMiddleware*ValidatesJWTtokensandprotectsroutes*Attachesuserinformationtorequestobjectforauthenticatedrequests*/import{Response,NextFunction}from'express';importjwtfrom'jsonwebtoken';import{AuthRequest,JWTPayload}from'../types';importloggerfrom'../utils/logger';/***MiddlewaretoverifyJWTtokenandauthenticaterequests*Usage:Addthismiddlewaretoroutesthatrequireauthentication*Example:router.get('/protected',authenticateToken,controller)*/exportfunctionauthenticateToken(req:AuthRequest,res:Response,next:NextFunction):void{try{//GettokenfromAuthorizationheader//Expectedformat:"Bearer<token>"constauthHeader=req.headers['authorization'];consttoken=authHeader&&authHeader.split('')[1];//Extracttokenafter"Bearer"if(!token){res.status(401).json({success:false,error:'Accesstokenrequired.PleaseprovideavalidtokeninAuthorizationheader.',});return;}//VerifytokenconstjwtSecret=process.env.JWT_SECRET;if(!jwtSecret){logger.error('JWT_SECRETnotconfiguredinenvironmentvariables');res.status(500).json({success:false,error:'Serverconfigurationerror',});return;}//DecodeandverifyJWTconstdecoded=jwt.verify(token,jwtSecret)asJWTPayload;//Attachuserinfotorequestobjectforuseincontrollersreq.user={userId:decoded.userId,email:decoded.email,};logger.debug(`Authenticateduser:${decoded.email}`);//Continuetonextmiddleware/controllernext();}catch(error){if(errorinstanceofjwt.TokenExpiredError){res.status(401).json({success:false,error:'Tokenexpired.Pleaseloginagain.',});return;}if(errorinstanceofjwt.JsonWebTokenError){res.status(401).json({success:false,error:'Invalidtoken.Pleaseloginagain.',});return;}//Unexpectederrorlogger.error(`Authenticationerror:${error}`);res.status(500).json({success:false,error:'Authenticationfailed',});}}./src/prismaClient.ts
===== FILE: ./src/prismaClient.ts =====
/***prismaClient.ts**PrismaClientSingletonwithconnectionretry*Ensures:*-OnlyonePrismaClientinstanceexists(preventspoolexhaustionindev)*-Automaticretriesfortransientnetworkerrors(e.g.,ECONNRESET)*/import{PrismaClient}from'@prisma/client';//GlobalaugmentationforTypeScriptdeclareglobal{//eslint-disable-next-lineno-varvarprisma:PrismaClient|undefined;}//CreatePrismaClientwithloggingindevelopmentconstprismaClient=global.prisma||newPrismaClient({log:process.env.NODE_ENV==='development'?['query','warn','error']:['error'],});//Storetheclientinglobalindevelopmenttopreventmultipleinstancesif(process.env.NODE_ENV!=='production'){global.prisma=prismaClient;}/***Connecttothedatabasewithretrylogic.*UsefulforremoteDBswithoccasionalnetworkblips.*/exportasyncfunctionconnectWithRetry(retries=5,delay=2000){for(leti=0;i<retries;i++){try{awaitprismaClient.$connect();console.log('âœ…Databaseconnected');return;}catch(err){console.error(`âŒDBconnectionfailed,retry${i+1}in${delay}ms`,err);awaitnewPromise((r)=>setTimeout(r,delay));}}thrownewError('ðŸ’¥Couldnotconnecttodatabaseafterretries');}//ImmediatelyattempttoconnectonimportconnectWithRetry();exportdefaultprismaClient;./src/routes/authRoutes.ts
===== FILE: ./src/routes/authRoutes.ts =====
/***AuthenticationRoutes*DefinesAPIendpointsforuserregistrationandlogin*/import{Router}from'express';import{signup,login}from'../controllers/authControllers';constrouter=Router();/***POST/api/auth/signup*Registeranewuser*Body:{email,password,name}*/router.post('/signup',signup);/***POST/api/auth/login*Loginexistinguser*Body:{email,password}*/router.post('/login',login);exportdefaultrouter;./src/routes/transactionRoutes.ts
===== FILE: ./src/routes/transactionRoutes.ts =====
/***TransactionRoutes*DefinesAPIendpointsfortransactionsandinsights*/import{Router}from'express';import{getTransactions,getInsights}from'../controllers/transactionControllers';import{authenticateToken}from'../middleware/auth';constrouter=Router();/***GET/api/transactions*Getalltransactionsforauthenticateduser*Requiresauthentication*Queryparams:page,limit,category,startDate,endDate*/router.get('/',authenticateToken,getTransactions);/***GET/api/insights*Getfinancialinsightsandanalytics*Requiresauthentication*Queryparams:startDate,endDate*/router.get('/insights',authenticateToken,getInsights);exportdefaultrouter;./src/routes/uploadRoutes.ts
===== FILE: ./src/routes/uploadRoutes.ts =====
/***UploadRoutes*DefinesAPIendpointsforfileuploads*/import{Router}from'express';importmulterfrom'multer';importpathfrom'path';import{uploadFile}from'../controllers/uploadControllers';import{authenticateToken}from'../middleware/auth';constrouter=Router();//Configuremulterforfileuploadsconststorage=multer.diskStorage({destination:(_req,_file,cb)=>{cb(null,process.env.UPLOAD_DIR||'./uploads');},filename:(_req,file,cb)=>{//Generateuniquefilename:timestamp-random-originalnameconstuniqueSuffix=`${Date.now()}-${Math.round(Math.random()*1E9)}`;cb(null,`${uniqueSuffix}-${file.originalname}`);},});//Filefilter-onlyallowCSVandPDFconstfileFilter=(_req:any,file:Express.Multer.File,cb:multer.FileFilterCallback)=>{constallowedTypes=['text/csv','application/pdf'];constallowedExtensions=['.csv','.pdf'];constext=path.extname(file.originalname).toLowerCase();if(allowedTypes.includes(file.mimetype)||allowedExtensions.includes(ext)){cb(null,true);}else{cb(newError('Invalidfiletype.OnlyCSVandPDFfilesareallowed.'));}};constupload=multer({storage,fileFilter,limits:{fileSize:parseInt(process.env.MAX_FILE_SIZE||'10485760'),//Default:10MB},});/***POST/api/upload*Uploadbankstatementfile(CSVorPDF)*Requiresauthentication*Content-Type:multipart/form-data*Fieldname:file*/router.post('/',authenticateToken,upload.single('file'),uploadFile);exportdefaultrouter;./src/services/mlClient.ts
===== FILE: ./src/services/mlClient.ts =====
/***MLServiceClient*HandlescommunicationwiththeFastAPIMLservice*Sendstransactionsforcategorypredictionandanomalydetection*/importaxios,{AxiosInstance}from'axios';import{MLPredictionRequest,MLPredictionResponse,AnomalyDetectionRequest,AnomalyDetectionResponse,ParsedTransaction,}from'../types';importloggerfrom'../utils/logger';classMLClient{privateclient:AxiosInstance;privatebaseURL:string;constructor(){this.baseURL=process.env.ML_SERVICE_URL||'http://localhost:8000';this.client=axios.create({baseURL:this.baseURL,timeout:30000,//30secondstimeoutheaders:{'Content-Type':'application/json',},});//LogMLserviceconfigurationlogger.info(`MLClientinitializedwithbaseURL:${this.baseURL}`);}/***Predictcategoriesforabatchoftransactions*/asyncpredictCategories(transactions:ParsedTransaction[]):Promise<MLPredictionResponse>{try{logger.info(`Sending${transactions.length}transactionstoMLserviceforprediction`);//FormattransactionsforMLserviceconstrequest:MLPredictionRequest={transactions:transactions.map(txn=>({description:txn.description,amount:txn.amount,date:txn.date.toISOString(),type:txn.type,})),};//CallMLserviceconstresponse=awaitthis.client.post<MLPredictionResponse>('/predict-batch',request);logger.info(`ReceivedpredictionsfromMLservice`);returnresponse.data;}catch(error){if(axios.isAxiosError(error)){conststatusCode=error.response?.status;consterrorMessage=error.response?.data?.detail||error.message;logger.error(`MLservicepredictionfailed(${statusCode}):${errorMessage}`);thrownewError(`MLpredictionfailed:${errorMessage}.PleaseensureMLserviceisrunning.`);}throwerror;}}/***Detectanomaliesintransactionpatterns*/asyncdetectAnomalies(transactions:{amount:number;category:string;date:Date}[]):Promise<AnomalyDetectionResponse>{try{logger.info(`Sending${transactions.length}transactionsforanomalydetection`);constrequest:AnomalyDetectionRequest={transactions:transactions.map(txn=>({amount:txn.amount,category:txn.category,date:txn.date.toISOString(),})),};constresponse=awaitthis.client.post<AnomalyDetectionResponse>('/detect-anomalies',request);logger.info(`Detected${response.data.anomalies.length}anomalies`);returnresponse.data;}catch(error){if(axios.isAxiosError(error)){logger.error(`MLserviceanomalydetectionfailed:${error.response?.data?.detail||error.message}`);//Anomalydetectionisoptional,sowereturnemptyresultinsteadofthrowingreturn{anomalies:[]};}throwerror;}}/***CheckifMLserviceishealthyandavailable*/asynchealthCheck():Promise<boolean>{try{constresponse=awaitthis.client.get('/health',{timeout:5000,});returnresponse.status===200;}catch(error){logger.warn(`MLservicehealthcheckfailed:${error}`);returnfalse;}}}//ExportsingletoninstanceexportdefaultnewMLClient();./src/types/index.ts
===== FILE: ./src/types/index.ts =====
/***TypeScriptTypeDefinitions*Centralizedtypesforthebackendapplication*/import{Request}from'express';//ExtendExpressRequesttoincludeauthenticateduserexportinterfaceAuthRequestextendsRequest{user?:{userId:string;email:string;};}//TransactiondatafromCSV/PDFparsingexportinterfaceParsedTransaction{date:Date;description:string;amount:number;type:'DEBIT'|'CREDIT';}//MLServicepredictionrequestexportinterfaceMLPredictionRequest{transactions:{description:string;amount:number;date:string;type:string;}[];}//MLServicepredictionresponseexportinterfaceMLPredictionResponse{predictions:{category:string;confidence:number;}[];}//AnomalydetectionrequestexportinterfaceAnomalyDetectionRequest{transactions:{amount:number;category:string;date:string;}[];}//AnomalydetectionresponseexportinterfaceAnomalyDetectionResponse{anomalies:{index:number;score:number;reason:string;}[];}//APIResponsewrapperexportinterfaceApiResponse<T=any>{success:boolean;data?:T;message?:string;error?:string;}//Userregistration/loginDTOsexportinterfaceRegisterDTO{email:string;password:string;name:string;}exportinterfaceLoginDTO{email:string;password:string;}//Insights/AnalyticsresponseexportinterfaceInsightsData{totalIncome:number;totalExpenses:number;netSavings:number;categoryBreakdown:{category:string;total:number;count:number;percentage:number;}[];monthlyTrend:{month:string;income:number;expenses:number;}[];topExpenses:{description:string;amount:number;date:Date;category:string;}[];}//JWTPayloadexportinterfaceJWTPayload{userId:string;email:string;}./src/utils/logger.ts
===== FILE: ./src/utils/logger.ts =====
/***WinstonLoggerConfiguration*Providesstructuredloggingwithdifferentloglevels*Logsarewrittentoconsoleandoptionallytofiles*/importwinstonfrom'winston';//Defineloglevelsconstlevels={error:0,warn:1,info:2,http:3,debug:4,};//Determineloglevelbasedonenvironmentconstlevel=()=>{constenv=process.env.NODE_ENV||'development';constisDevelopment=env==='development';returnisDevelopment?'debug':'warn';};//Definecolorsforeachlevelconstcolors={error:'red',warn:'yellow',info:'green',http:'magenta',debug:'white',};//Tellwinstontousethesecolorswinston.addColors(colors);//Definelogformatconstformat=winston.format.combine(winston.format.timestamp({format:'YYYY-MM-DDHH:mm:ss'}),winston.format.colorize({all:true}),winston.format.printf((info)=>`${info.timestamp}${info.level}:${info.message}`));//Definetransports(wherelogsaresent)consttransports=[//Consoletransport-alwaysactivenewwinston.transports.Console(),//Filetransports-optional(canbeenabledinproduction)//newwinston.transports.File({//filename:'logs/error.log',//level:'error',//}),//newwinston.transports.File({filename:'logs/all.log'}),];//Createtheloggerinstanceconstlogger=winston.createLogger({level:level(),levels,format,transports,});exportdefaultlogger;./src/utils/parseCSV.ts
===== FILE: ./src/utils/parseCSV.ts =====
/***CSVParserUtility*ParsesbankstatementCSVfilesandextractstransactiondata*SupportscommonCSVformatswithflexiblecolumnmapping*/importfsfrom'fs';importcsvParserfrom'csv-parser';import{ParsedTransaction}from'../types';importloggerfrom'./logger';/***ParseaCSVfileandextracttransactions*@paramfilePath-PathtotheCSVfile*@returnsPromise<ParsedTransaction[]>*/exportasyncfunctionparseCSV(filePath:string):Promise<ParsedTransaction[]>{returnnewPromise((resolve,reject)=>{consttransactions:ParsedTransaction[]=[];consterrors:string[]=[];fs.createReadStream(filePath).pipe(csvParser()).on('data',(row:any)=>{try{//Parsetransactionfromrow//SupportmultipleCSVformatswithflexiblecolumnnamesconsttransaction=extractTransactionFromRow(row);if(transaction){transactions.push(transaction);}}catch(error){consterrorMsg=errorinstanceofError?error.message:'Unknownerror';errors.push(`Errorparsingrow:${errorMsg}`);logger.warn(`CSVparsingerror:${errorMsg}`);}}).on('end',()=>{if(transactions.length===0&&errors.length>0){logger.error(`CSVparsingfailed:${errors.join(',')}`);reject(newError('NovalidtransactionsfoundinCSV'));}else{logger.info(`Successfullyparsed${transactions.length}transactionsfromCSV`);resolve(transactions);}}).on('error',(error)=>{logger.error(`CSVfilereaderror:${error.message}`);reject(error);});});}/***ExtracttransactiondatafromaCSVrow*HandlesvariousCSVformatsbycheckingmultiplepossiblecolumnnames*/functionextractTransactionFromRow(row:any):ParsedTransaction|null{//Trytofinddatecolumn(commonvariations)constdateValue=row.date||row.Date||row.DATE||row.transaction_date||row['TransactionDate']||row.posting_date||row['PostingDate'];//Trytofinddescriptioncolumnconstdescription=row.description||row.Description||row.DESCRIPTION||row.details||row.Details||row.DETAILS||row.merchant||row.Merchant||row.narrative||row.Narrative;//TrytofindamountcolumnconstamountValue=row.amount||row.Amount||row.AMOUNT||row.value||row.Value||row.transaction_amount||row['TransactionAmount'];//Trytofinddebit/creditcolumnsconstdebitValue=row.debit||row.Debit||row.DEBIT||row.withdrawal||row.Withdrawal;constcreditValue=row.credit||row.Credit||row.CREDIT||row.deposit||row.Deposit;//Validaterequiredfieldsif(!dateValue||!description){returnnull;}//Parsedateconstdate=parseDate(dateValue);if(!date){returnnull;}//Parseamountanddeterminetypeletamount:number;lettype:'DEBIT'|'CREDIT';if(amountValue!==undefined&&amountValue!==null&&amountValue!==''){//Singleamountcolumn-negativefordebit,positiveforcreditamount=parseFloat(String(amountValue).replace(/[^0-9.-]/g,''));type=amount<0?'DEBIT':'CREDIT';amount=Math.abs(amount);}elseif(debitValue!==undefined&&debitValue!==null&&debitValue!==''){//Separatedebitcolumnamount=parseFloat(String(debitValue).replace(/[^0-9.-]/g,''));type='DEBIT';}elseif(creditValue!==undefined&&creditValue!==null&&creditValue!==''){//Separatecreditcolumnamount=parseFloat(String(creditValue).replace(/[^0-9.-]/g,''));type='CREDIT';}else{returnnull;//Novalidamountfound}//Validateamountif(isNaN(amount)||amount<=0){returnnull;}return{date,description:String(description).trim(),amount,type,};}/***Parsevariousdateformats*Supports:YYYY-MM-DD,DD/MM/YYYY,MM/DD/YYYY,etc.*/functionparseDate(dateStr:string):Date|null{try{//Removeextrawhitespaceconstcleaned=String(dateStr).trim();//TryparsingasISOdatefirstletdate=newDate(cleaned);if(!isNaN(date.getTime())){returndate;}//TryparsingDD/MM/YYYYorMM/DD/YYYYconstparts=cleaned.split(/[/-]/);if(parts.length===3){//TryDD/MM/YYYYdate=newDate(`${parts[2]}-${parts[1]}-${parts[0]}`);if(!isNaN(date.getTime())){returndate;}//TryMM/DD/YYYYdate=newDate(`${parts[2]}-${parts[0]}-${parts[1]}`);if(!isNaN(date.getTime())){returndate;}}returnnull;}catch(error){returnnull;}}./src/utils/parsePDF.ts
===== FILE: ./src/utils/parsePDF.ts =====
/***PDFParserUtility*ExtractstextfromPDFbankstatementsandparsestransactiondata*Usespatternmatchingtoidentifytransactionlines*/importpdfParsefrom'pdf-parse';importfsfrom'fs/promises';import{ParsedTransaction}from'../types';importloggerfrom'./logger';/***ParseaPDFfileandextracttransactions*@paramfilePath-PathtothePDFfile*@returnsPromise<ParsedTransaction[]>*/exportasyncfunctionparsePDF(filePath:string):Promise<ParsedTransaction[]>{try{//ReadPDFfileconstdataBuffer=awaitfs.readFile(filePath);//ðŸ‘‡assertthetypemanuallybecausepdf-parse'stypingsarewrongconstpdf=pdfParseasunknownas(data:Buffer)=>Promise<{text:string}>;constpdfData=awaitpdf(dataBuffer);consttext=pdfData.text;logger.info(`Extracted${text.length}charactersfromPDF`);//Extracttransactionsfromtextconsttransactions=extractTransactionsFromText(text);logger.info(`Successfullyparsed${transactions.length}transactionsfromPDF`);returntransactions;}catch(error){consterrorMsg=errorinstanceofError?error.message:'Unknownerror';logger.error(`PDFparsingerror:${errorMsg}`);thrownewError(`FailedtoparsePDF:${errorMsg}`);}}/***ExtracttransactionsfromPDFtextusingpatternmatching*Thisisaheuristicapproachthatworksforcommonbankstatementformats*/functionextractTransactionsFromText(text:string):ParsedTransaction[]{consttransactions:ParsedTransaction[]=[];constlines=text.split('\n');//Commonpatternsfortransactionlines://1.Datefollowedbydescriptionandamount//2.Typically:DD/MM/YYYYorMM/DD/YYYYorYYYY-MM-DD//3.Amount:numberwithoptionalcomma/periodseparatorsfor(constlineoflines){consttrimmedLine=line.trim();if(!trimmedLine)continue;//Trytomatchtransactionpatternconsttransaction=parseTransactionLine(trimmedLine);if(transaction){transactions.push(transaction);}}returntransactions;}/***Parseasinglelineoftextasatransaction*Returnsnullifthelinedoesn'tmatchatransactionpattern*/functionparseTransactionLine(line:string):ParsedTransaction|null{//Pattern1:Dateatthebeginning(DD/MM/YYYYorMM/DD/YYYYorYYYY-MM-DD)constdatePattern=/^(\d{1,2}[/-]\d{1,2}[/-]\d{2,4}|\d{4}[/-]\d{1,2}[/-]\d{1,2})/;constdateMatch=line.match(datePattern);if(!dateMatch){returnnull;}constdateStr=dateMatch[1];constdate=parseDate(dateStr);if(!date){returnnull;}//RemovedatefromlineconstremainingLine=line.substring(dateStr.length).trim();//Findamount(typicallyattheendoftheline)//Pattern:Optionalcurrencysymbol,digitswithoptionalcommas/periods,optionalminussignconstamountPattern=/([+-]?[\$Â£â‚¬]?\s?[\d,]+\.?\d*)\s*$/;constamountMatch=remainingLine.match(amountPattern);if(!amountMatch){returnnull;}constamountStr=amountMatch[1];constamount=parseFloat(amountStr.replace(/[^\d.-]/g,''));if(isNaN(amount)||amount===0){returnnull;}//Descriptioniseverythingbetweendateandamountconstdescription=remainingLine.substring(0,remainingLine.length-amountStr.length).trim();if(!description||description.length<2){returnnull;}//Determinetransactiontypeconsttype:'DEBIT'|'CREDIT'=amount<0||amountStr.includes('-')?'DEBIT':'CREDIT';return{date,description,amount:Math.abs(amount),type,};}/***Parsevariousdateformats*/functionparseDate(dateStr:string):Date|null{try{constcleaned=dateStr.trim();//TryISOformatletdate=newDate(cleaned);if(!isNaN(date.getTime())){returndate;}//TryDD/MM/YYYYorMM/DD/YYYYconstparts=cleaned.split(/[/-]/);if(parts.length===3){//Expand2-digityearto4-digitif(parts[2].length===2){constyear=parseInt(parts[2]);parts[2]=(year<50?'20':'19')+parts[2];}//TryDD/MM/YYYYdate=newDate(`${parts[2]}-${parts[1]}-${parts[0]}`);if(!isNaN(date.getTime())){returndate;}//TryMM/DD/YYYYdate=newDate(`${parts[2]}-${parts[0]}-${parts[1]}`);if(!isNaN(date.getTime())){returndate;}}returnnull;}catch{returnnull;}}./tsconfig.json
===== FILE: ./tsconfig.json =====
{"compilerOptions":{"target":"ES2020","module":"commonjs","lib":["ES2020"],"outDir":"./dist","rootDir":"./src","strict":true,"esModuleInterop":true,"skipLibCheck":true,"forceConsistentCasingInFileNames":true,"resolveJsonModule":true,"moduleResolution":"node","declaration":true,"declarationMap":true,"sourceMap":true,"noUnusedLocals":true,"noUnusedParameters":true,"noImplicitReturns":true,"noFallthroughCasesInSwitch":true},"include":["src/**/*"],"exclude":["node_modules","dist","**/*.test.ts"]}